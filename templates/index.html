<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Secure File Upload</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
<style>
body {
    background: radial-gradient(circle at top, #0b0b11, #050508, #010102);
    color: #e0e0e0;
    font-family: 'Share Tech Mono', monospace;
    overflow-y: auto;
    overflow-x: hidden;
    position: relative;
}
#floating-container { position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:1; }
.panel {
    max-width: 580px; margin: 80px auto; padding: 40px;
    background: rgba(20,20,30,0.70); border-radius:14px; border:2px solid #383838;
    box-shadow:0 0 12px #3a9efb44; backdrop-filter: blur(6px); z-index:10; position:relative;
}
h2 { text-align:center; font-weight:600; margin-bottom:25px; }
input { background: rgba(255,255,255,0.05); border:1px solid #555; color:white; }
input:focus { border-color:#888; background: rgba(255,255,255,0.08); }
.sha-matte { word-wrap: break-word; background: rgba(255,255,255,0.04); padding:10px 12px; border-radius:6px; border:1px solid #444; font-size:14px; }
.btn-upload { background:#1d1d1d; border:1px solid #666; color:#e2e2e2; text-transform:uppercase; }
.btn-upload:hover { background:#262626; }
#access-link { display:none; margin-top:10px; }
img { max-width:240px; border-radius:4px; border:2px solid #333; }
</style>
<script>
window.onload = function() {
    // floating icons (locks/links)
    const container = document.createElement('div'); container.id='floating-container'; document.body.appendChild(container);
    const numIcons = 40; let icons = [];
    function getContainerHeight(){ return Math.max(document.documentElement.scrollHeight, window.innerHeight); }
    for(let i=0;i<numIcons;i++){
        const icon = document.createElement('i');
        icon.className = (i%2===0) ? 'fas fa-lock' : 'fas fa-link';
        icon.style.position='absolute';
        icon.style.fontSize=(12+Math.random()*16)+'px';
        icon.style.opacity=0.3+Math.random()*0.7;
        icon.style.left=Math.random()*(window.innerWidth-20)+'px';
        icon.style.top=Math.random()*(getContainerHeight()-20)+'px';
        icon.dx=(Math.random()*0.5+0.1)*(Math.random()<0.5?1:-1);
        icon.dy=(Math.random()*0.3+0.05)*(Math.random()<0.5?1:-1);
        container.appendChild(icon); icons.push(icon);
    }
    function animateIcons(){
        const width=window.innerWidth, height=getContainerHeight();
        icons.forEach(icon=>{
            let x=parseFloat(icon.style.left), y=parseFloat(icon.style.top);
            x+=icon.dx; y+=icon.dy;
            if(x<0){ x=0; icon.dx*=-1; } if(x>width-20){ x=width-20; icon.dx*=-1; }
            if(y<0){ y=0; icon.dy*=-1; } if(y>height-20){ y=height-20; icon.dy*=-1; }
            icon.style.left = x+'px'; icon.style.top = y+'px';
            if(Math.random()<0.005) icon.style.opacity = 0.3 + Math.random()*0.7;
        });
        requestAnimationFrame(animateIcons);
    }
    animateIcons();
    window.addEventListener('resize', ()=>{ icons.forEach(icon=>{
        const width=window.innerWidth, height=getContainerHeight();
        if(parseFloat(icon.style.left)>width-20) icon.style.left=(width-20)+'px';
        if(parseFloat(icon.style.top)>height-20) icon.style.top=(height-20)+'px';
    });});

    const qr = document.getElementById('qr-image'); if(qr) qr.onload = ()=>{ document.getElementById('access-link').style.display='block'; };
};
</script>
</head>
<body>
<div class="panel">
<h2>Secure File Upload</h2>

{% if error %}<div class="alert alert-danger text-center">{{ error }}</div>{% endif %}

<form action="{{ url_for('upload') }}" method="POST" enctype="multipart/form-data">
    <input type="file" name="file" class="form-control mb-3" required>
    <input type="password" name="password" class="form-control mb-3" placeholder="Set file password" required>
    <button class="btn btn-upload w-100">Upload & Generate QR</button>
</form>

{% if file_name %}
<div class="text-center mt-4">
    <h5>{{ file_name }}</h5>
    <p><strong>SHA-256 Checksum:</strong></p>
    <p class="sha-matte">{{ checksum }}</p>
    <img src="{{ qr_path }}" class="img-fluid mt-3" id="qr-image">
    <div id="access-link">Open link: <a href="{{ access_url }}" target="_blank">{{ access_url }}</a></div>
</div>
{% endif %}
</div>
</body>
</html>
